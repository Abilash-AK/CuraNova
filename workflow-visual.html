<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CuraNova - Complete Project Workflow</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            color: white;
            padding: 60px 20px;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.3rem;
            opacity: 0.95;
        }

        .section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            font-size: 2.2rem;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section h3 {
            color: #764ba2;
            font-size: 1.6rem;
            margin: 30px 0 20px 0;
        }

        .diagram-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            overflow-x: auto;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
        }

        .mermaid {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }

        .architecture-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-left: 5px solid #667eea;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .architecture-box h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .architecture-box ul {
            margin-left: 20px;
        }

        .architecture-box li {
            margin: 8px 0;
            color: #555;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .tech-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .tech-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
        }

        .tech-card h4 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tech-card p {
            opacity: 0.95;
            line-height: 1.8;
        }

        .routes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .route-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }

        .route-card:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .route-card h5 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .route-card code {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            display: block;
            margin: 8px 0;
            color: #764ba2;
            font-size: 0.9rem;
            font-family: 'Courier New', monospace;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 2.5rem;
            margin: 10px 0;
            color: white;
        }

        .stat-card p {
            font-size: 1rem;
            opacity: 0.95;
        }

        .navigation {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.15);
            max-width: 250px;
            z-index: 1000;
        }

        .navigation h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .navigation a {
            display: block;
            color: #555;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 8px;
            margin: 5px 0;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .navigation a:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .print-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
        }

        .print-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
        }

        @media print {
            .navigation, .print-button {
                display: none;
            }
            body {
                background: white;
            }
            .section {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }
            .navigation {
                position: static;
                margin: 20px;
                max-width: 100%;
            }
            .tech-stack, .routes-grid, .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .flow-step {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }

        .flow-step::after {
            content: '‚Üì';
            display: block;
            text-align: center;
            font-size: 2rem;
            color: #667eea;
            margin: 10px 0 -10px 0;
        }

        .flow-step:last-child::after {
            content: '';
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .emoji {
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <div class="navigation">
        <h4>üìë Quick Navigation</h4>
        <a href="#architecture">Architecture</a>
        <a href="#auth-flow">Authentication</a>
        <a href="#api-routes">API Routes</a>
        <a href="#ai-features">AI Features</a>
        <a href="#meditron-integration">Meditron 7B</a>
        <a href="#database">Database</a>
        <a href="#deployment">Deployment</a>
        <a href="#performance">Performance</a>
    </div>

    <header>
        <h1>üè• CuraNova</h1>
        <p>Complete Project Workflow & Architecture</p>
    </header>

    <div class="container">
        <!-- Stats Overview -->
        <div class="section">
            <h2><span class="emoji">üìä</span> Project Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="emoji">üöÄ</span>
                    <h3>28+</h3>
                    <p>API Endpoints</p>
                </div>
                <div class="stat-card">
                    <span class="emoji">üè•</span>
                    <h3>3.8GB</h3>
                    <p>Meditron 7B</p>
                </div>
                <div class="stat-card">
                    <span class="emoji">ÔøΩ</span>
                    <h3>$0</h3>
                    <p>AI Cost/Request</p>
                </div>
                <div class="stat-card">
                    <span class="emoji">üë•</span>
                    <h3>80+</h3>
                    <p>Patients</p>
                </div>
                <div class="stat-card">
                    <span class="emoji">‚ö°</span>
                    <h3>1-3s</h3>
                    <p>AI Response</p>
                </div>
                <div class="stat-card">
                    <span class="emoji">üì¶</span>
                    <h3>323KB</h3>
                    <p>Worker Bundle</p>
                </div>
            </div>
        </div>

        <!-- System Architecture -->
        <div class="section" id="architecture">
            <h2><span class="emoji">üèóÔ∏è</span> System Architecture Overview</h2>
            
            <div class="diagram-container">
                <div class="mermaid">
graph TB
    subgraph UI["üë• USER INTERFACES"]
        Doctor["üë®‚Äç‚öïÔ∏è Doctor Portal<br/>Full Access + AI"]
        Nurse["üë©‚Äç‚öïÔ∏è Nurse Portal<br/>Patient Management"]
        Patient["üßë‚Äçü¶± Patient Portal<br/>Read-only Access"]
    end
    
    subgraph Frontend["‚öõÔ∏è REACT 19 FRONTEND"]
        Components["üì¶ Components<br/>16 Modals"]
        Contexts["üîÑ Contexts<br/>Auth, Role, Theme"]
        Pages["üé® Pages<br/>Dashboard, Patients"]
    end
    
    subgraph Worker["‚òÅÔ∏è CLOUDFLARE WORKERS"]
        Hono["üî• Hono Framework 4.7.7"]
        Middleware["üõ°Ô∏è Middleware<br/>Auth, CORS, Validation"]
        Routes["üì° 28+ API Routes"]
    end
    
    subgraph Storage["üíæ DATA LAYER"]
        D1["üóÑÔ∏è D1 Database<br/>SQLite at Edge"]
        Sessions["üîê Active Sessions"]
    end
    
    subgraph AI["ü§ñ AI SERVICES"]
        Meditron["üè• Meditron 7B (Local)"]
        Ollama["‚ö° Ollama Runtime"]
        Gemini["ü§ñ Gemini (Fallback)"]
        Meditron --> Ollama
    end
    
    subgraph APIs["üåê EXTERNAL APIS"]
        PubMed["üìö PubMed eUtils"]
        OAuth["üîë Google OAuth 2.0"]
    end
    
    Doctor --> Frontend
    Nurse --> Frontend
    Patient --> Frontend
    
    Frontend --> Components
    Frontend --> Contexts
    Frontend --> Pages
    
    Components --> Worker
    Contexts --> Worker
    Pages --> Worker
    
    Worker --> Hono
    Hono --> Middleware
    Middleware --> Routes
    
    Routes --> D1
    Routes --> Sessions
    Routes --> Meditron
    Routes --> Gemini
    Routes --> PubMed
    Routes --> OAuth
    
    style UI fill:#667eea,stroke:#764ba2,color:#fff
    style Frontend fill:#48bb78,stroke:#38a169,color:#fff
    style Worker fill:#ed8936,stroke:#dd6b20,color:#fff
    style Storage fill:#4299e1,stroke:#3182ce,color:#fff
    style AI fill:#f56565,stroke:#c53030,color:#fff
    style APIs fill:#9f7aea,stroke:#805ad5,color:#fff
                </div>
            </div>

            <div class="tech-stack">
                <div class="tech-card">
                    <h4>‚öõÔ∏è Frontend</h4>
                    <p><strong>React 19</strong> with Vite<br>
                    <strong>Tailwind CSS</strong> for styling<br>
                    <strong>Context API</strong> for state<br>
                    <strong>React Router</strong> for navigation</p>
                </div>
                <div class="tech-card">
                    <h4>‚òÅÔ∏è Backend</h4>
                    <p><strong>Hono Framework 4.7.7</strong><br>
                    <strong>Cloudflare Workers</strong><br>
                    <strong>Edge Computing</strong><br>
                    <strong>13KB ultra-fast</strong></p>
                </div>
                <div class="tech-card">
                    <h4>üíæ Database</h4>
                    <p><strong>Cloudflare D1</strong><br>
                    <strong>SQLite at Edge</strong><br>
                    <strong>16 Migrations</strong><br>
                    <strong>6 Core Tables</strong></p>
                </div>
                <div class="tech-card">
                    <h4>ü§ñ AI Services</h4>
                    <p><strong>Meditron 7B (Primary)</strong><br>
                    <strong>Ollama Runtime</strong><br>
                    <strong>Gemini AI (Fallback)</strong><br>
                    <strong>Local Inference</strong></p>
                </div>
                <div class="tech-card">
                    <h4>üåê External APIs</h4>
                    <p><strong>PubMed eUtils</strong><br>
                    <strong>Google OAuth 2.0</strong><br>
                    <strong>RESTful APIs</strong><br>
                    <strong>Medical Literature</strong></p>
                </div>
            </div>
        </div>

        <!-- Authentication Flow -->
        <div class="section" id="auth-flow">
            <h2><span class="emoji">üîê</span> Authentication Flow</h2>
            
            <h3>Doctor/Nurse OAuth Flow</h3>
            <div class="diagram-container">
                <div class="mermaid">
sequenceDiagram
    participant U as üë®‚Äç‚öïÔ∏è User
    participant F as Frontend
    participant W as Worker
    participant G as Google OAuth
    participant DB as Database

    U->>F: Opens Application
    F->>W: GET /api/users/me
    W-->>F: No Session
    F->>U: Show Login Page
    U->>F: Click "Sign in with Google"
    F->>W: GET /api/oauth/google/redirect_url
    W->>W: Generate OAuth State
    W-->>F: Return Google Auth URL
    F->>G: Redirect to Google
    G->>U: Show Login
    U->>G: Authenticate
    G->>F: Redirect with code
    F->>W: POST /api/sessions (code)
    W->>G: Exchange code for token
    G-->>W: User info
    W->>W: Check email pattern<br/>.01.doctor / .02.nurse
    W->>DB: Create session
    W-->>F: Set HTTP-Only Cookie
    F->>U: Redirect to Dashboard ‚úì
                </div>
            </div>

            <h3>Patient Portal Flow</h3>
            <div class="diagram-container">
                <div class="mermaid">
flowchart TD
    A[üßë‚Äçü¶± Patient Visits Portal] --> B[Enter MRN + DOB]
    B --> C{POST /api/patient-login}
    C -->|Valid| D[Generate Session Token]
    C -->|Invalid| B
    D --> E[Store in patient_sessions]
    E --> F[Return token to frontend]
    F --> G[Store in localStorage]
    G --> H[Redirect to Dashboard]
    H --> I[GET /api/patient-data/:mrn]
    I --> J[Display Health Records]
    
    style A fill:#667eea,stroke:#764ba2,color:#fff
    style D fill:#48bb78,stroke:#38a169,color:#fff
    style J fill:#48bb78,stroke:#38a169,color:#fff
    style C fill:#ed8936,stroke:#dd6b20,color:#fff
                </div>
            </div>
        </div>

        <!-- API Routes -->
        <div class="section" id="api-routes">
            <h2><span class="emoji">üì°</span> API Routes (28+ Endpoints)</h2>
            
            <div class="routes-grid">
                <div class="route-card">
                    <h5>üîê Authentication</h5>
                    <code>GET /api/oauth/google/redirect_url</code>
                    <code>POST /api/sessions</code>
                    <code>GET /api/users/me</code>
                    <code>GET /api/logout</code>
                </div>

                <div class="route-card">
                    <h5>üë• Patient Management</h5>
                    <code>GET /api/patients</code>
                    <code>GET /api/patients/:id</code>
                    <code>POST /api/patients</code>
                    <code>PUT /api/patients/:id</code>
                    <code>DELETE /api/patients/:id</code>
                </div>

                <div class="route-card">
                    <h5>üìã Medical Records</h5>
                    <code>POST /api/patients/:id/medical-records</code>
                    <code>PUT /api/patients/:pid/medical-records/:rid</code>
                    <code>DELETE /api/patients/:pid/medical-records/:rid</code>
                </div>

                <div class="route-card">
                    <h5>üß™ Lab Results</h5>
                    <code>POST /api/patients/:id/lab-results</code>
                    <code>PUT /api/patients/:pid/lab-results/:rid</code>
                    <code>DELETE /api/patients/:pid/lab-results/:rid</code>
                </div>

                <div class="route-card">
                    <h5>ü§ñ AI Features</h5>
                    <code>GET /api/patients/:id/similar</code>
                    <code>GET /api/patients/:id/literature</code>
                    <code>POST /api/patients/:id/ai-summary</code>
                    <code>POST /api/chatbot</code>
                    <code>GET /api/patient-health-summary/:mrn</code>
                </div>

                <div class="route-card">
                    <h5>üßë‚Äçü¶± Patient Portal</h5>
                    <code>POST /api/patient-login</code>
                    <code>GET /api/patient-data/:mrn</code>
                    <code>POST /api/patient-logout</code>
                    <code>PUT /api/patient-profile/:mrn</code>
                </div>
            </div>
        </div>

        <!-- AI Features -->
        <div class="section" id="ai-features">
            <h2><span class="emoji">ü§ñ</span> AI-Powered Features with Meditron 7B</h2>
            
            <div class="architecture-box" style="background: linear-gradient(135deg, #f5656515 0%, #c5303015 100%); border-left: 5px solid #f56565;">
                <h4>üè• Three-Tier AI Fallback System</h4>
                <ul>
                    <li><strong>Primary:</strong> Meditron 7B (Local, $0 cost, HIPAA-compliant)</li>
                    <li><strong>Secondary:</strong> Google Gemini API (Cloud fallback, $0.001/request)</li>
                    <li><strong>Tertiary:</strong> Static Templates (Always available)</li>
                    <li><strong>Cache:</strong> 60-minute TTL, 30-50% hit rate</li>
                    <li><strong>Cost Savings:</strong> $180-$5,400+ annually vs cloud APIs</li>
                </ul>
            </div>

            <div class="architecture-box">
                <h4>üí¨ Medical AI Chatbot</h4>
                <ul>
                    <li><strong>Primary Model:</strong> Meditron 7B (medical-specific LLM)</li>
                    <li><strong>Fallback Model:</strong> Google Gemini 1.5 Flash</li>
                    <li><strong>Training Data:</strong> PubMed (48B tokens), clinical guidelines, medical textbooks</li>
                    <li><strong>Context:</strong> Last 10 messages maintained</li>
                    <li><strong>Features:</strong> Evidence-based medical information, clinical guidelines (JNC-8, ADA)</li>
                    <li><strong>Response Time:</strong> 1-3s (Meditron), <100ms (cached)</li>
                    <li><strong>UI:</strong> Floating button, copy/print options</li>
                </ul>
            </div>

            <div class="diagram-container">
                <div class="mermaid">
flowchart LR
    A[üë®‚Äç‚öïÔ∏è Doctor Query] --> B[POST /api/chatbot]
    B --> C{Ollama Available?}
    C -->|Yes| D[Meditron 7B Local]
    C -->|No| E[Gemini AI Fallback]
    D --> F{Process with Context}
    E --> F
    F --> G[Medical Guidelines]
    F --> H[Evidence-based Info]
    G --> I[Return Response]
    H --> I
    I --> J[Display in Chat UI]
    
    style A fill:#667eea,stroke:#764ba2,color:#fff
    style D fill:#f56565,stroke:#c53030,color:#fff
    style E fill:#9f7aea,stroke:#805ad5,color:#fff
    style I fill:#48bb78,stroke:#38a169,color:#fff
                </div>
            </div>

            <div class="architecture-box">
                <h4>üìö Medical Literature Search</h4>
                <ul>
                    <li><strong>Source:</strong> PubMed eUtils API</li>
                    <li><strong>Process:</strong> Extract conditions ‚Üí Build query ‚Üí Search ‚Üí Score relevance</li>
                    <li><strong>Scoring Algorithm:</strong>
                        <ul>
                            <li>Base score: 0.4</li>
                            <li>Title match: +0.30</li>
                            <li>Abstract keywords: +0.15</li>
                            <li>Recent publications: +0.12 (2023+)</li>
                            <li>Review/meta-analysis: +0.10</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div class="architecture-box">
                <h4>üìä Patient Health Summary (Meditron-Powered)</h4>
                <ul>
                    <li><strong>Primary Engine:</strong> Meditron 7B with medical-specific training</li>
                    <li><strong>Caching:</strong> OllamaCache with 60-minute TTL for instant responses</li>
                    <li><strong>Sections:</strong> 7 comprehensive sections
                        <ul>
                            <li>‚ë† Health Overview (simple terms)</li>
                            <li>‚ë° Diagnoses Explained (plain language)</li>
                            <li>‚ë¢ Medication Information (purpose, dosing, side effects)</li>
                            <li>‚ë£ Foods to Eat & Avoid (condition-specific diet)</li>
                            <li>‚ë§ Lifestyle Measures (exercise, stress, sleep)</li>
                            <li>‚ë• Lab Results Interpretation</li>
                            <li>‚ë¶ Important Reminders (adherence, warning signs)</li>
                        </ul>
                    </li>
                    <li><strong>Fallback Chain:</strong> Meditron ‚Üí Gemini ‚Üí Static (249 lines)</li>
                    <li><strong>Performance:</strong> 1-3s (Meditron), <100ms (cached), 500ms-2s (Gemini)</li>
                    <li><strong>Output:</strong> Patient-friendly Markdown, copy/print enabled</li>
                </ul>
            </div>

            <div class="diagram-container">
                <div class="mermaid">
flowchart TD
    A[üßë‚Äçü¶± Patient Request] --> B[GET /api/patient-health-summary/:mrn]
    B --> C{Check Cache}
    C -->|Hit| D[Return Cached Summary]
    C -->|Miss| E{Ollama Available?}
    E -->|Yes| F[Meditron 7B Generation]
    E -->|No| G{Gemini Available?}
    F --> H[Format for Patient]
    G -->|Yes| I[Gemini API Call]
    G -->|No| J[Static Fallback]
    I --> H
    J --> H
    H --> K[Cache Response]
    K --> L[Display Summary]
    D --> L
    
    style A fill:#667eea,stroke:#764ba2,color:#fff
    style F fill:#f56565,stroke:#c53030,color:#fff
    style I fill:#9f7aea,stroke:#805ad5,color:#fff
    style D fill:#48bb78,stroke:#38a169,color:#fff
    style L fill:#48bb78,stroke:#38a169,color:#fff
                </div>
            </div>
        </div>

        <!-- Meditron Integration -->
        <div class="section" id="meditron-integration">
            <h2><span class="emoji">üè•</span> Meditron 7B Integration</h2>
            
            <div class="architecture-box" style="background: linear-gradient(135deg, #f5656515 0%, #c5303015 100%); border-left: 5px solid #f56565;">
                <h4>Why Meditron 7B?</h4>
                <ul>
                    <li><strong>Cost Savings:</strong> $0 per request vs $0.001+ for cloud APIs</li>
                    <li><strong>Privacy:</strong> All medical data stays local (HIPAA-compliant)</li>
                    <li><strong>Medical Accuracy:</strong> Trained on PubMed, clinical guidelines, medical literature (48B tokens)</li>
                    <li><strong>Offline Capability:</strong> Works without internet connection</li>
                    <li><strong>Fast Response:</strong> Local inference (1-3 seconds on modern hardware)</li>
                    <li><strong>Annual Savings:</strong> $180 - $5,400+ compared to cloud APIs</li>
                </ul>
            </div>

            <div class="diagram-container">
                <div class="mermaid">
graph TB
    subgraph Client["üíª CuraNova Frontend"]
        UI[React UI]
    end
    
    subgraph Worker["‚òÅÔ∏è Cloudflare Worker"]
        API[Hono API Routes]
        OClient[OllamaClient]
        Cache[OllamaCache]
        Prompts[Meditron Prompts]
    end
    
    subgraph Local["üñ•Ô∏è Local Machine"]
        Ollama[Ollama Service]
        Meditron[Meditron 7B Model]
        Ollama --> Meditron
    end
    
    subgraph Cloud["‚òÅÔ∏è Cloud Fallback"]
        Gemini[Google Gemini API]
    end
    
    UI --> API
    API --> Cache
    Cache -->|Miss| OClient
    OClient -->|Primary| Ollama
    OClient -->|Fallback| Gemini
    Ollama --> OClient
    Gemini --> OClient
    OClient --> Prompts
    Prompts --> UI
    
    style Client fill:#667eea,stroke:#764ba2,color:#fff
    style Worker fill:#ed8936,stroke:#dd6b20,color:#fff
    style Local fill:#f56565,stroke:#c53030,color:#fff
    style Cloud fill:#9f7aea,stroke:#805ad5,color:#fff
                </div>
            </div>

            <div class="tech-stack">
                <div class="tech-card" style="border-left: 5px solid #f56565;">
                    <h4>üè• OllamaClient</h4>
                    <p><strong>generate()</strong> - Text generation<br>
                    <strong>chat()</strong> - Conversational AI<br>
                    <strong>healthCheck()</strong> - Service validation<br>
                    <strong>listModels()</strong> - Model enumeration</p>
                </div>
                <div class="tech-card" style="border-left: 5px solid #48bb78;">
                    <h4>üíæ OllamaCache</h4>
                    <p><strong>get()</strong> - Retrieve cached<br>
                    <strong>set()</strong> - Store with TTL<br>
                    <strong>generateKey()</strong> - Cache keys<br>
                    <strong>60-min TTL</strong> - Auto expiration</p>
                </div>
                <div class="tech-card" style="border-left: 5px solid #667eea;">
                    <h4>üìù Meditron Prompts</h4>
                    <p><strong>MEDICAL_SYSTEM_PROMPT</strong><br>
                    <strong>HEALTH_SUMMARY_TEMPLATE</strong><br>
                    <strong>CHATBOT_SYSTEM_PROMPT</strong><br>
                    <strong>buildPatientDataString()</strong></p>
                </div>
                <div class="tech-card" style="border-left: 5px solid #9f7aea;">
                    <h4>‚ö° Performance</h4>
                    <p><strong>First request:</strong> 3-5s<br>
                    <strong>Cached:</strong> <100ms<br>
                    <strong>Warm model:</strong> 1-3s<br>
                    <strong>GPU:</strong> 200-500ms</p>
                </div>
            </div>

            <div class="architecture-box">
                <h4>üì¶ Integration Files</h4>
                <ul>
                    <li><code>src/worker/lib/ollama-client.ts</code> - Ollama API client (200+ lines)</li>
                    <li><code>src/worker/lib/meditron-prompts.ts</code> - Medical prompts (210+ lines)</li>
                    <li><code>src/worker/index.ts</code> - Updated routes with Meditron integration</li>
                    <li><code>worker-configuration.d.ts</code> - OLLAMA_URL environment type</li>
                    <li><code>.dev.vars</code> - OLLAMA_URL="http://localhost:11434"</li>
                    <li><code>test-meditron.ps1</code> - Automated testing script</li>
                    <li><code>MEDITRON_SETUP.md</code> - Complete installation guide</li>
                    <li><code>MEDITRON_IMPLEMENTATION.md</code> - Technical documentation</li>
                </ul>
            </div>
        </div>

        <!-- Database Schema -->
        <div class="section" id="database">
            <h2><span class="emoji">üóÑÔ∏è</span> Database Schema</h2>
            
            <div class="diagram-container">
                <div class="mermaid">
erDiagram
    USERS ||--o{ ACTIVE_SESSIONS : has
    USERS ||--|| DOCTORS : is
    DOCTORS ||--o{ PATIENTS : treats
    PATIENTS ||--o{ MEDICAL_RECORDS : has
    PATIENTS ||--o{ LAB_RESULTS : has
    PATIENTS ||--o{ PATIENT_SESSIONS : has
    DOCTORS ||--o{ MEDICAL_RECORDS : creates
    DOCTORS ||--o{ LAB_RESULTS : orders

    USERS {
        int id PK
        string email UK
        string name
        string picture
        timestamp created_at
    }

    DOCTORS {
        int id PK
        string name
        string specialization
        string license_number
        string phone
        string email
    }

    PATIENTS {
        int id PK
        string first_name
        string last_name
        date date_of_birth
        string gender
        string medical_record_number UK
        string blood_type
        int doctor_id FK
    }

    MEDICAL_RECORDS {
        int id PK
        int patient_id FK
        int doctor_id FK
        date visit_date
        string diagnosis
        string prescription
    }

    LAB_RESULTS {
        int id PK
        int patient_id FK
        string test_name
        string test_value
        date test_date
    }

    ACTIVE_SESSIONS {
        int id PK
        int user_id FK
        string session_token
        string user_role
        timestamp last_activity
    }
                </div>
            </div>

            <div class="architecture-box">
                <h4>üìã Key Tables</h4>
                <ul>
                    <li><strong>users:</strong> OAuth user information</li>
                    <li><strong>doctors:</strong> Doctor profiles and credentials</li>
                    <li><strong>patients:</strong> 80+ patient records with demographics</li>
                    <li><strong>medical_records:</strong> Visit history, diagnoses, prescriptions</li>
                    <li><strong>lab_results:</strong> Test results with abnormal flags</li>
                    <li><strong>active_sessions:</strong> Session management (30-min timeout)</li>
                    <li><strong>patient_sessions:</strong> Patient portal sessions</li>
                </ul>
            </div>
        </div>

        <!-- Deployment -->
        <div class="section" id="deployment">
            <h2><span class="emoji">üöÄ</span> Build & Deployment</h2>
            
            <div class="flow-step">
                <strong>Step 1: TypeScript Compilation</strong>
                <div class="code-block">tsc -b
# Type check all .ts/.tsx files
# Ensure no type errors</div>
            </div>

            <div class="flow-step">
                <strong>Step 2: Vite Build</strong>
                <div class="code-block">vite build
# Worker Bundle: 305.84 KiB
# Client Bundle: 848.66 KiB
# Tree-shake + Minify</div>
            </div>

            <div class="flow-step">
                <strong>Step 3: Deploy Worker</strong>
                <div class="code-block">npx wrangler deploy
# Upload to Cloudflare network
# Deploy to 300+ cities
# Bind D1 database</div>
            </div>

            <div class="flow-step">
                <strong>Step 4: Apply Migrations</strong>
                <div class="code-block">wrangler d1 migrations apply
# Apply 16 migrations
# Seed 80+ patients</div>
            </div>

            <div class="architecture-box">
                <h4>üåç Global Distribution</h4>
                <ul>
                    <li><strong>Edge Locations:</strong> 300+ cities worldwide</li>
                    <li><strong>Latency:</strong> &lt;50ms API response time</li>
                    <li><strong>Startup Time:</strong> &lt;1ms worker startup</li>
                    <li><strong>Auto-scaling:</strong> Handles traffic spikes automatically</li>
                    <li><strong>Security:</strong> DDoS protection, HTTPS only</li>
                </ul>
            </div>
        </div>

        <!-- Performance -->
        <div class="section" id="performance">
            <h2><span class="emoji">‚ö°</span> Performance Optimizations</h2>
            
            <div class="tech-stack">
                <div class="tech-card">
                    <h4>üé® Frontend</h4>
                    <p>
                        ‚úÖ React 19 automatic batching<br>
                        ‚úÖ Code splitting by route<br>
                        ‚úÖ Lazy loading modals<br>
                        ‚úÖ Memoized components<br>
                        ‚úÖ Debounced search<br>
                        ‚úÖ Optimized Tailwind CSS
                    </p>
                </div>

                <div class="tech-card">
                    <h4>‚öôÔ∏è Backend</h4>
                    <p>
                        ‚úÖ Edge computing (300+ locations)<br>
                        ‚úÖ Hono framework (13KB)<br>
                        ‚úÖ D1 at edge<br>
                        ‚úÖ HTTP-only cookies<br>
                        ‚úÖ Session cleanup<br>
                        ‚úÖ Prepared statements
                    </p>
                </div>

                <div class="tech-card">
                    <h4>üíæ Caching</h4>
                    <p>
                        ‚úÖ Cloudflare CDN<br>
                        ‚úÖ Browser caching headers<br>
                        ‚úÖ Session caching<br>
                        ‚úÖ Asset optimization<br>
                        ‚úÖ Gzip compression<br>
                        ‚úÖ Edge caching
                    </p>
                </div>

                <div class="tech-card">
                    <h4>üìä Results</h4>
                    <p>
                        üöÄ &lt;50ms API response<br>
                        üöÄ 95+ Lighthouse score<br>
                        üöÄ 305KB worker bundle<br>
                        üöÄ &lt;1ms startup time<br>
                        üöÄ 99.99% uptime<br>
                        üöÄ Global edge network
                    </p>
                </div>
            </div>
        </div>

        <!-- Security -->
        <div class="section">
            <h2><span class="emoji">üîí</span> Security Features</h2>
            
            <div class="diagram-container">
                <div class="mermaid">
flowchart TD
    A[User Request] --> B{Has Cookie?}
    B -->|Yes| C[authMiddleware]
    B -->|No| D[Return 401]
    C --> E{Session Valid?}
    E -->|Yes| F[Check Expiry]
    E -->|No| D
    F -->|Active| G[Update last_activity]
    F -->|Expired| H[Delete Session]
    G --> I[Attach User to Context]
    I --> J[Continue to Route]
    H --> D
    
    style A fill:#667eea,stroke:#764ba2,color:#fff
    style I fill:#48bb78,stroke:#38a169,color:#fff
    style D fill:#f56565,stroke:#c53030,color:#fff
                </div>
            </div>

            <div class="architecture-box">
                <h4>üõ°Ô∏è Security Measures</h4>
                <ul>
                    <li><strong>Authentication:</strong> Google OAuth 2.0 with state verification</li>
                    <li><strong>Sessions:</strong> HTTP-only cookies (XSS protection)</li>
                    <li><strong>Authorization:</strong> Role-based access control (RBAC)</li>
                    <li><strong>Validation:</strong> Zod schema validation on all inputs</li>
                    <li><strong>Database:</strong> Prepared statements (SQL injection prevention)</li>
                    <li><strong>HTTPS:</strong> Secure flag on all cookies</li>
                    <li><strong>CORS:</strong> Configured for specific origins only</li>
                    <li><strong>Session Timeout:</strong> 30-minute idle timeout</li>
                </ul>
            </div>
        </div>

        <button class="print-button" onclick="window.print()">üñ®Ô∏è Print Workflow Documentation</button>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            fontFamily: 'Segoe UI, sans-serif',
            flowchart: {
                curve: 'basis',
                padding: 20
            }
        });

        // Smooth scroll for navigation
        document.querySelectorAll('.navigation a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        // Add animation on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '0';
                    entry.target.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        entry.target.style.transition = 'all 0.6s ease';
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }, 100);
                }
            });
        });

        document.querySelectorAll('.section').forEach(section => {
            observer.observe(section);
        });
    </script>
</body>
</html>